<hr class="my-4">

<!-- Status Channels Section -->
<div class="mb-4 card p-3">
    <h4>Status Channels</h4>
    <p class="form-text">Status channels display container status messages with restricted control access.</p>
    <div class="alert alert-info small">
        <strong>Permissions:</strong>
        <br>‚Ä¢ <strong>All users:</strong> Can use <code>/serverstatus</code> command to view container status
        <br>‚Ä¢ <strong>Admin users:</strong> Full access to Start, Stop, Restart buttons, <code>/task</code> commands, Info system, and Admin Control Panel
    </div>
    <div class="d-flex justify-content-between mb-3">
        <button type="button" class="btn btn-success btn-sm" onclick="addStatusChannelRow()">+ Add Channel</button>
        <button type="button" class="btn btn-warning btn-sm" onclick="openAdminModal()">üë§ Admin Users</button>
    </div>
    <table class="table table-dark table-sm small table-hover" id="status-channels-table">
        <thead>
            <tr>
                <th scope="col" style="width: 15%;">Channel Name<i class="bi bi-question-circle help-icon" data-bs-toggle="tooltip" title="A display name to help you remember which channel this is"></i></th>
                <th scope="col" style="width: 20%;">Channel ID<i class="bi bi-question-circle help-icon" data-bs-toggle="tooltip" title="The Discord channel ID. Enable Developer Mode in Discord, then right-click the channel and select Copy ID"></i></th>
                <th scope="col" class="text-center" style="width: 10%;" data-bs-toggle="tooltip" title="Post initial status messages on bot start?">Initial<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" class="text-center" style="width: 10%; border-left: 3px solid #0dcaf0;" data-bs-toggle="tooltip" title="Enable periodic status updates?">Refresh<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" style="width: 10%;" data-bs-toggle="tooltip" title="Update status messages every X minutes (if refresh is enabled).">Minutes</th>
                <th scope="col" class="text-center" style="width: 10%; border-left: 3px solid #0dcaf0;" data-bs-toggle="tooltip" title="Recreate messages after channel inactivity?">Recreate<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" style="width: 10%;" data-bs-toggle="tooltip" title="Recreate messages after X minutes of inactivity.">Minutes</th>
                <th scope="col" class="text-center" style="width: 5%; border-left: 3px solid #0dcaf0;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% set channel_permissions = config.get('channel_permissions', {}) %}
            {% set defaults = config.get('default_channel_permissions', DEFAULT_CONFIG['default_channel_permissions']) %}
            {% set status_channel_count = 0 %}
            {% for channel_id, channel_data in channel_permissions.items() %}
                {% if not channel_data.commands.control %}
                    {% set status_channel_count = status_channel_count + 1 %}
                    <tr id="status-channel-row-{{ status_channel_count }}">
                        <td><input type="text" class="form-control form-control-sm" name="status_channel_name_{{ status_channel_count }}" value="{{ channel_data.name }}" placeholder="Channel Name"></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" name="status_channel_id_{{ status_channel_count }}" value="{{ channel_id }}" placeholder="Channel ID">
                            <input type="hidden" name="old_status_channel_id_{{ status_channel_count }}" value="{{ channel_id }}">
                        </td>
                        <td class="text-center">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="status_post_initial_{{ status_channel_count }}" value="1" {% if channel_data.post_initial %}checked{% endif %}>
                                <label class="form-check-label visually-hidden">Initial</label>
                            </div>
                        </td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <div class="form-check">
                                <input class="form-check-input auto-refresh-checkbox" type="checkbox" name="status_enable_auto_refresh_{{ status_channel_count }}" value="1" {% set is_ar_checked = channel_data.get('enable_auto_refresh', defaults.get('enable_auto_refresh', False)) %}{% if is_ar_checked %}checked{% endif %} data-target-input=".interval-minutes-input">
                                <label class="form-check-label visually-hidden">Refresh</label>
                            </div>
                        </td>
                        <td><input type="number" class="form-control form-control-sm interval-minutes-input" name="status_update_interval_minutes_{{ status_channel_count }}" value="{{ channel_data.get('update_interval_minutes', defaults.get('update_interval_minutes', 1)) }}" min="1" style="width: 70px;" {% if not is_ar_checked %}disabled{% endif %}></td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <div class="form-check">
                                <input class="form-check-input recreate-checkbox" type="checkbox" name="status_recreate_messages_{{ status_channel_count }}" value="1" {% set is_ri_checked = channel_data.get('recreate_messages_on_inactivity', defaults.get('recreate_messages_on_inactivity', False)) %}{% if is_ri_checked %}checked{% endif %} data-target-input=".inactivity-minutes-input">
                                <label class="form-check-label visually-hidden">Recreate on Inactivity</label>
                            </div>
                        </td>
                        <td><input type="number" class="form-control form-control-sm inactivity-minutes-input" name="status_inactivity_timeout_{{ status_channel_count }}" value="{{ channel_data.get('inactivity_timeout_minutes', defaults.get('inactivity_timeout_minutes', 1)) }}" min="1" style="width: 70px;" {% if not is_ri_checked %}disabled{% endif %}></td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <button type="button" class="btn btn-sm btn-danger remove-channel-btn" data-row-id="status-channel-row-{{ status_channel_count }}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
            {% if status_channel_count == 0 %}
                <tr id="status-channel-row-1">
                    <td><input type="text" class="form-control form-control-sm" name="status_channel_name_1" placeholder="Channel Name"></td>
                    <td>
                        <input type="text" class="form-control form-control-sm" name="status_channel_id_1" placeholder="Channel ID">
                        <input type="hidden" name="old_status_channel_id_1" value="">
                    </td>
                    <td class="text-center">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="status_post_initial_1" value="1" {% if defaults.get('post_initial', False) %}checked{% endif %}>
                            <label class="form-check-label visually-hidden">Initial</label>
                        </div>
                    </td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <div class="form-check">
                            <input class="form-check-input auto-refresh-checkbox" type="checkbox" name="status_enable_auto_refresh_1" value="1" {% if defaults.get('enable_auto_refresh', False) %}checked{% endif %} data-target-input=".interval-minutes-input">
                            <label class="form-check-label visually-hidden">Refresh</label>
                        </div>
                    </td>
                    <td><input type="number" class="form-control form-control-sm interval-minutes-input" name="status_update_interval_minutes_1" value="{{ defaults.get('update_interval_minutes', 1) }}" min="1" style="width: 70px;" {% if not defaults.get('enable_auto_refresh', False) %}disabled{% endif %}></td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <div class="form-check">
                            <input class="form-check-input recreate-checkbox" type="checkbox" name="status_recreate_messages_1" value="1" {% if defaults.get('recreate_messages_on_inactivity', False) %}checked{% endif %} data-target-input=".inactivity-minutes-input">
                            <label class="form-check-label visually-hidden">Recreate on Inactivity</label>
                        </div>
                    </td>
                    <td><input type="number" class="form-control form-control-sm inactivity-minutes-input" name="status_inactivity_timeout_1" value="{{ defaults.get('inactivity_timeout_minutes', 1) }}" min="1" style="width: 70px;" {% if not defaults.get('recreate_messages_on_inactivity', False) %}disabled{% endif %}></td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <button type="button" class="btn btn-sm btn-danger remove-channel-btn" data-row-id="status-channel-row-1">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Control Channels Section -->
<div class="mb-3 card p-3">
    <h4>Control Channels</h4>
    <p class="form-text">Control channels provide full container management capabilities to ALL users in the channel.</p>
    <div class="alert alert-warning small">
        <strong>üö® Security Warning:</strong> ALL users in control channels have unrestricted access to ALL container management functions including Start, Stop, Restart, /task commands, and Info editing. Only add trusted channels here!
    </div>
    <div class="mb-3">
        <button type="button" class="btn btn-success btn-sm" onclick="addControlChannelRow()">+ Add Channel</button>
    </div>
    <table class="table table-dark table-sm small table-hover" id="control-channels-table">
        <thead>
            <tr>
                <th scope="col" style="width: 15%;">Channel Name<i class="bi bi-question-circle help-icon" data-bs-toggle="tooltip" title="A display name to help you remember which channel this is"></i></th>
                <th scope="col" style="width: 20%;">Channel ID<i class="bi bi-question-circle help-icon" data-bs-toggle="tooltip" title="The Discord channel ID. Enable Developer Mode in Discord, then right-click the channel and select Copy ID"></i></th>
                <th scope="col" class="text-center" style="width: 10%;" data-bs-toggle="tooltip" title="Post initial control messages on bot start?">Initial<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" class="text-center" style="width: 10%; border-left: 3px solid #0dcaf0;" data-bs-toggle="tooltip" title="Enable periodic status updates?">Refresh<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" style="width: 10%;" data-bs-toggle="tooltip" title="Update control messages every X minutes (if refresh is enabled).">Minutes</th>
                <th scope="col" class="text-center" style="width: 10%; border-left: 3px solid #0dcaf0;" data-bs-toggle="tooltip" title="Recreate messages after channel inactivity?">Recreate<i class="bi bi-question-circle help-icon"></i></th>
                <th scope="col" style="width: 10%;" data-bs-toggle="tooltip" title="Recreate messages after X minutes of inactivity.">Minutes</th>
                <th scope="col" class="text-center" style="width: 5%; border-left: 3px solid #0dcaf0;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% set control_channel_count = 0 %}
            {% for channel_id, channel_data in channel_permissions.items() %}
                {% if channel_data.commands.control %}
                    {% set control_channel_count = control_channel_count + 1 %}
                    <tr id="control-channel-row-{{ control_channel_count }}">
                        <td><input type="text" class="form-control form-control-sm" name="control_channel_name_{{ control_channel_count }}" value="{{ channel_data.name }}" placeholder="Channel Name"></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" name="control_channel_id_{{ control_channel_count }}" value="{{ channel_id }}" placeholder="Channel ID">
                            <input type="hidden" name="old_control_channel_id_{{ control_channel_count }}" value="{{ channel_id }}">
                        </td>
                        <td class="text-center">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="control_post_initial_{{ control_channel_count }}" value="1" {% if channel_data.post_initial %}checked{% endif %}>
                                <label class="form-check-label visually-hidden">Initial</label>
                            </div>
                        </td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <div class="form-check">
                                <input class="form-check-input auto-refresh-checkbox" type="checkbox" name="control_enable_auto_refresh_{{ control_channel_count }}" value="1" {% set is_ar_checked = channel_data.get('enable_auto_refresh', defaults.get('enable_auto_refresh', False)) %}{% if is_ar_checked %}checked{% endif %} data-target-input=".interval-minutes-input">
                                <label class="form-check-label visually-hidden">Refresh</label>
                            </div>
                        </td>
                        <td><input type="number" class="form-control form-control-sm interval-minutes-input" name="control_update_interval_minutes_{{ control_channel_count }}" value="{{ channel_data.get('update_interval_minutes', defaults.get('update_interval_minutes', 1)) }}" min="1" style="width: 70px;" {% if not is_ar_checked %}disabled{% endif %}></td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <div class="form-check">
                                <input class="form-check-input recreate-checkbox" type="checkbox" name="control_recreate_messages_{{ control_channel_count }}" value="1" {% set is_ri_checked = channel_data.get('recreate_messages_on_inactivity', defaults.get('recreate_messages_on_inactivity', False)) %}{% if is_ri_checked %}checked{% endif %} data-target-input=".inactivity-minutes-input">
                                <label class="form-check-label visually-hidden">Recreate on Inactivity</label>
                            </div>
                        </td>
                        <td><input type="number" class="form-control form-control-sm inactivity-minutes-input" name="control_inactivity_timeout_{{ control_channel_count }}" value="{{ channel_data.get('inactivity_timeout_minutes', defaults.get('inactivity_timeout_minutes', 1)) }}" min="1" style="width: 70px;" {% if not is_ri_checked %}disabled{% endif %}></td>
                        <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                            <button type="button" class="btn btn-sm btn-danger remove-channel-btn" data-row-id="control-channel-row-{{ control_channel_count }}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
            {% if control_channel_count == 0 %}
                <tr id="control-channel-row-1">
                    <td><input type="text" class="form-control form-control-sm" name="control_channel_name_1" placeholder="Channel Name"></td>
                    <td>
                        <input type="text" class="form-control form-control-sm" name="control_channel_id_1" placeholder="Channel ID">
                        <input type="hidden" name="old_control_channel_id_1" value="">
                    </td>
                    <td class="text-center">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="control_post_initial_1" value="1" {% if defaults.get('post_initial', False) %}checked{% endif %}>
                            <label class="form-check-label visually-hidden">Initial</label>
                        </div>
                    </td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <div class="form-check">
                            <input class="form-check-input auto-refresh-checkbox" type="checkbox" name="control_enable_auto_refresh_1" value="1" {% if defaults.get('enable_auto_refresh', False) %}checked{% endif %} data-target-input=".interval-minutes-input">
                            <label class="form-check-label visually-hidden">Refresh</label>
                        </div>
                    </td>
                    <td><input type="number" class="form-control form-control-sm interval-minutes-input" name="control_update_interval_minutes_1" value="{{ defaults.get('update_interval_minutes', 1) }}" min="1" style="width: 70px;" {% if not defaults.get('enable_auto_refresh', False) %}disabled{% endif %}></td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <div class="form-check">
                            <input class="form-check-input recreate-checkbox" type="checkbox" name="control_recreate_messages_1" value="1" {% if defaults.get('recreate_messages_on_inactivity', False) %}checked{% endif %} data-target-input=".inactivity-minutes-input">
                            <label class="form-check-label visually-hidden">Recreate on Inactivity</label>
                        </div>
                    </td>
                    <td><input type="number" class="form-control form-control-sm inactivity-minutes-input" name="control_inactivity_timeout_1" value="{{ defaults.get('inactivity_timeout_minutes', 1) }}" min="1" style="width: 70px;" {% if not defaults.get('recreate_messages_on_inactivity', False) %}disabled{% endif %}></td>
                    <td class="text-center" style="border-left: 3px solid #0dcaf0;">
                        <button type="button" class="btn btn-sm btn-danger remove-channel-btn" data-row-id="control-channel-row-1">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Admin Users Modal -->
<div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="adminModalLabel">üë§ Discord Admin Users</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Admin users have full container control in Status Channels, including Start/Stop/Restart buttons, /task commands, Info system, and Admin Control Panel (üõ†Ô∏è button).</p>
                <div class="alert alert-info small">
                    <strong>Note:</strong> This only affects Status Channels. In Control Channels, ALL users have full access regardless of admin status.
                </div>
                <div class="mb-3">
                    <label class="form-label">Add Admin User</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="newAdminId" placeholder="Discord User ID (e.g., 766595606574530581)">
                        <input type="text" class="form-control" id="newAdminNote" placeholder="Note (optional, e.g., Username)">
                        <button class="btn btn-success" type="button" onclick="addAdminUser()">Add</button>
                    </div>
                    <small class="form-text text-muted">To get a Discord User ID: Enable Developer Mode in Discord, right-click on user, and select "Copy User ID"</small>
                </div>
                <hr>
                <h6>Current Admin Users</h6>
                <div id="adminUsersList" class="list-group">
                    <!-- Admin users will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveAdminUsers()">Save Changes</button>
            </div>
        </div>
    </div>
</div>